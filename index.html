<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Peter Grassberger <petertheone@gmail.com>, Dieter Zirnig">

    <title>neuwal barometer</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div class="container" id="content">
      <h1><a href="#"><img class="img-responsive" src="images/barometer-logo.jpg" alt="neuwal barometer" /></a></h1>

      <section id="page-1" class="page row">
        <div class="col-md-12">
          <h2>Einleitung</h2>

          <p>
            Lorem ipsum dolor sit amet, cu quando impedit cotidieque duo, vitae nostrum assentior
            ne nam, sea an dico sint ullum. Ad has justo errem, labore everti posidonium et duo.
            Harum dolor fastidii ne quo. Eam ea mazim adipisci, audiam hendrerit eum ea. Wisi
            mucius mel te. Mea virtute omnesque periculis ea.
          </p>

          <h3>Wähle eine Kandidatin oder einen Kandidaten..</h3>
        </div>

        <div class="candidates">

        </div>
      </section>

      <section id="page-2" class="page hidden">
        <h2>Wie würdest du als <span class="candidateName">???</span> abstimmen?</h2>

        <div class="questions">

        </div>

        <button class="btn btn-primary back">Zurück</button>
        <button class="btn btn-primary reset">Zurücksetzen</button>
        <button class="btn btn-success next">Zur Auswertung</button>
      </section>

      <section id="page-3" class="page hidden">
        <h2>Ergebnisse: <span class="candidateName">???</span></h2>

        <div class="results">

        </div>

        <div class="finalResult">
          <span class="congratulations"></span><br />
          Score: <span class="score"></span>
        </div>

        <p>
          Auf <a class="facebook" href="" target="_blank">Facebook</a> oder <a class="twitter" href="" target="_blank">Twitter</a> teilen!
        </p>


        <button class="btn btn-primary back">Zurück</button>
        <button class="btn btn-success start">Zurück zum Start</button>
      </section>
    </div>

    <div id="templates" class="hidden">
      <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 candidate">
        <a href="#">
          <p>
            <span class="party"></span> - <span class="name"></span>
          </p>
        </a>
      </div>
      <div class="row question">
        <div class="col-md-6 text"><h3></h3></div>
        <div class="col-md-6 answer">
          <input class="sliderHandle" /><br />
          <span class="pull-left">Ablehnung</span><span class="pull-right">Zustimmung</span>
        </div>
      </div>
      <div class="row result">
        <div class="col-md-12 text"><h3></h3></div>
        <div class="col-md-6 video">
          <div>
            <div class="playHandle"></div>
            <iframe class="hidden" src="" frameborder="0" allowfullscreen></iframe>
          </div>
        </div>
        <div class="col-md-6 answer">
          <div class="col-xs-4 userValue">
            <img src="" alt="" /><br />
            <span>Deine Einschätzung</span>
          </div>
          <div class="col-xs-4 candidateValue">
            <img src="" alt="" /><br />
            <span class="candidateName"></span>
          </div>
          <div class="col-xs-4 resultMeaning">
            <img src="" alt="" /><br />
            <span>Differenz</span>
          </div>
        </div>
      </div>
    </div>

    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script>
      'use strict';

      var candidates = [
        {
          "id": "spoe-haeupl",
          "name": "Michael Häupl",
          "party": {
            "shortname": "SPÖ",
            "name": "Sozialdemokratische Partei Österreichs"
          },
          "imageUrl": "images/candidates/spoe-haeupl-small-000.jpg"
        },
        {
          "id": "fpoe-strache",
          "name": "Heinz-Christian Strache",
          "party": {
            "shortname": "FPÖ",
            "name": "Freiheitliche Partei Österreichs"
          },
          "imageUrl": "images/candidates/fpoe-strache-small-29.jpg"
        },
        {
          "id": "oevp-juraczka",
          "name": "Manfred Juraczka",
          "party": {
            "shortname": "ÖVP",
            "name": "Österreichische Volkspartei"
          },
          "imageUrl": "images/candidates/oevp-juraczka-small-08.jpg"
        },
        {
          "id": "gruene-vassilakou",
          "name": "Maria Vassilakou",
          "party": {
            "shortname": "GRÜNE",
            "name": "Die Grünen – Die Grüne Alternative"
          },
          "imageUrl": "images/candidates/gruene-vassilakou-small-27.jpg"
        },
        {
          "id": "neos-meinl-reisinger",
          "name": "Beate Meinl-Reisinger",
          "party": {
            "shortname": "NEOS",
            "name": "NEOS – Das Neue Österreich und Liberales Forum"
          },
          "imageUrl": "images/candidates/neos-meinl-reisinger-small-00.jpg"
        },
        {
          "id": "andas-okropiridse",
          "name": "Juliana Okropiridse",
          "party": {
            "shortname": "ANDAS",
            "name": "Wien anders"
          },
          "imageUrl": "images/candidates/andas-okropiridse-small-09.jpg"
        },
        {
          "id": "www-pollischansky",
          "name": "Heinz Pollischansky",
          "party": {
            "shortname": "WWW",
            "name": "WWW - Wir Wollen Wahlfreiheit"
          },
          "imageUrl": "images/candidates/www-pollischansky-small-00.jpg"
        },
        {
          "id": "gfw-taskiran",
          "name": "Turgay Taskiran",
          "party": {
            "shortname": "GFW",
            "name": "GfW - Gemeinsam für Wien"
          },
          "imageUrl": "images/candidates/gfw-taskiran-small-00.jpg"
        }
      ];

      var questions = [
        {
          "text": "AsylwerberInnen sollen arbeiten dürfen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "5",
              "youtubeVideoId": "yN5jfV7KyNg"
            },
            "fpoe-strache": {
              "answer": "3",
              "youtubeVideoId": "kcJbjTt9kI0"
            },
            "gruene-vassilakou": {
              "answer": "10",
              "youtubeVideoId": "DzQyQijfRt4"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "TxmtnKAEQNU"
            },
            "neos-meinl-reisinger": {
              "answer": "8",
              "youtubeVideoId": "XURg2PReiRI"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "3BSDIlkui30"
            },
            "www-pollischansky": {
              "answer": "10",
              "youtubeVideoId": "hx2JQxLXRa8"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "2fJLkIUc1zE"
            }
          }
        },
        {
          "text": "Bezirksquoten sollen eingeführt werden, um die Verteilung der Flüchtlinge zu regeln.",
          "answers": {
            "spoe-haeupl": {
              "answer": "8",
              "youtubeVideoId": "JxXBDnobVqI"
            },
            "fpoe-strache": {
              "answer": "1",
              "youtubeVideoId": "svvWCfJ33nM"
            },
            "gruene-vassilakou": {
              "answer": "9",
              "youtubeVideoId": "Quv89FHMJRI"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "fvlAlNR_A-M"
            },
            "neos-meinl-reisinger": {
              "answer": "7",
              "youtubeVideoId": "QPk5T7ZGFAo"
            },
            "andas-okropiridse": {
              "answer": "5",
              "youtubeVideoId": "b-_rs7n-ivY"
            },
            "www-pollischansky": {
              "answer": "6",
              "youtubeVideoId": "lGE85YVZTGQ"
            },
            "gfw-taskiran": {
              "answer": "8",
              "youtubeVideoId": "5YyZOTj-vew"
            }
          }
        },
        {
          "text": "Die Unterstützung für Arbeitslose sollte gesenkt werden, um mehr Anreize bei der Arbeitssuche zu schaffen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "idwo9ywA-XA"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "RtIHlTuEMjQ"
            },
            "gruene-vassilakou": {
              "answer": "2",
              "youtubeVideoId": "T4Rs2htRxEY"
            },
            "oevp-juraczka": {
              "answer": "5",
              "youtubeVideoId": "nH5N_9XqnPI"
            },
            "neos-meinl-reisinger": {
              "answer": "2",
              "youtubeVideoId": "3Qx6t_V_Iho"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "Ld3N8WuXQCQ"
            },
            "www-pollischansky": {
              "answer": "2",
              "youtubeVideoId": "uSIRrymo-6g"
            },
            "gfw-taskiran": {
              "answer": "5",
              "youtubeVideoId": "C7eCcJTRVE4"
            }
          }
        },
        {
          "text": "Nur durch Privatisierungen schaffe ich konkurrenzfähige Unternehmen und somit auch Arbeitsplätze.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "nHXfev2e3_s"
            },
            "fpoe-strache": {
              "answer": "8",
              "youtubeVideoId": "kJxLoB2E_cg"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "Uzx9ONOHSUg"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "hZiACfntWEY"
            },
            "neos-meinl-reisinger": {
              "answer": "5",
              "youtubeVideoId": "_QWJ3ZPdrEo"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "RvNUpbmoleo"
            },
            "www-pollischansky": {
              "answer": "4",
              "youtubeVideoId": "rxGKPCBRCQ4"
            },
            "gfw-taskiran": {
              "answer": "7",
              "youtubeVideoId": "mdF3fOuuKpA"
            }
          }
        },
        {
          "text": "Es braucht eigene Klassen für SchülerInnen, die nicht über ausreichende Deutschkenntnisse verfügen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "2",
              "youtubeVideoId": "be2kXEewO6s"
            },
            "fpoe-strache": {
              "answer": "9",
              "youtubeVideoId": "nl_2Z4Els_g"
            },
            "gruene-vassilakou": {
              "answer": "2",
              "youtubeVideoId": "QdwSbKOr2eE"
            },
            "oevp-juraczka": {
              "answer": "10",
              "youtubeVideoId": "qmJyrG4azj8"
            },
            "neos-meinl-reisinger": {
              "answer": "7",
              "youtubeVideoId": "AtDw-ASl2gg"
            },
            "andas-okropiridse": {
              "answer": "2",
              "youtubeVideoId": "ulLCw9f9_1s"
            },
            "www-pollischansky": {
              "answer": "10",
              "youtubeVideoId": "IbEphbIRl4A"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "2Pfo-HREYP8"
            }
          }
        },
        {
          "text": "Politische Bildung ist zu teuer.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "8BdJAocitNg"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "a-GG1qMed1E"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "j4r7vul92T0"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "MU3N5RblSZQ"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "aFA6rfbb4zk"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "RztPQ8lo6dQ"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "4uB1d3Ds8Hs"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "Ty2EOG48-Mk"
            }
          }
        },
        {
          "text": "Im Zweifel müssen umweltpolitische Bedenken wirtschaftlichen Interessen weichen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "7",
              "youtubeVideoId": "gcHWiJgyw94"
            },
            "fpoe-strache": {
              "answer": "5",
              "youtubeVideoId": "Ah7Lou8slOs"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "MDbvAazl10w"
            },
            "oevp-juraczka": {
              "answer": "6",
              "youtubeVideoId": "MVa-1f4myLg"
            },
            "neos-meinl-reisinger": {
              "answer": "3",
              "youtubeVideoId": "bVePHg-RR7Y"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "jcaQbHMabJk"
            },
            "www-pollischansky": {
              "answer": "5",
              "youtubeVideoId": "RSh2qVK5W34"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "W1SXC71AJIY"
            }
          }
        },
        {
          "text": "Meine verkehrspolitische Vision basiert auf einer autofreien Stadt.",
          "answers": {
            "spoe-haeupl": {
              "answer": "4",
              "youtubeVideoId": "N3KuKVRnDV8"
            },
            "fpoe-strache": {
              "answer": "1",
              "youtubeVideoId": "Q7GsQkIRo5s"
            },
            "gruene-vassilakou": {
              "answer": "7",
              "youtubeVideoId": "zpc5-Eswq6U"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "h4E72QiAmjY"
            },
            "neos-meinl-reisinger": {
              "answer": "6",
              "youtubeVideoId": "aMVJO5QgjU0"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "BC16d7-LqWI"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "zutoNkDbQMw"
            },
            "gfw-taskiran": {
              "answer": "5",
              "youtubeVideoId": "pwnZt4TgUEk"
            }
          }
        },
        {
          "text": "Für private Altbauwohnungen soll es Mietobergrenzen geben.",
          "answers": {
            "spoe-haeupl": {
              "answer": "9",
              "youtubeVideoId": "Kc1kVuCsQlg"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "CeQ6QLAMlFk"
            },
            "gruene-vassilakou": {
              "answer": "9",
              "youtubeVideoId": "__1rwAX6ECc"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "CSgYHxMwEcA"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "gD-eTRY3iLM"
            },
            "andas-okropiridse": {
              "answer": "6",
              "youtubeVideoId": "0T7Zxxof6Zc"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "ss19nG6Jy3w"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "kL4pNkpGSoc"
            }
          }
        },
        {
          "text": "Die regelmäßige Überprüfung der Einkommen von BewohnerInnen von Gemeinde- oder Genossenschaftswohnungen wäre gerechtfertigt.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "Y8dLTtFWDPc"
            },
            "fpoe-strache": {
              "answer": "5",
              "youtubeVideoId": "CeQ6QLAMlFk"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "pitPhZ2xfnU"
            },
            "oevp-juraczka": {
              "answer": "10",
              "youtubeVideoId": "Gr1srS6-7O8"
            },
            "neos-meinl-reisinger": {
              "answer": "10",
              "youtubeVideoId": "86nmORL76fw"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "QT_gWThgUzw"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "VglFN5HVbLk"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "05BwMh6I4-s"
            }
          }
        }
      ];

      var congratulationLines = [
        {
          "text": "Du bist super gut.",
          "minScore": 90
        },
        {
          "text": "Fail.",
          "minScore": 0
        }
      ];

      var currentCandidate = null;

      $(function() {
        init();

        function init() {
          currentCandidate = null;

          // set url to current page
          showPage(window.location.hash);

          $(window).on('hashchange', function(event) {
            event.preventDefault();
            showPage(window.location.hash);
          });
        }

        function showPage(hash) {
          if (!hash) {
            hash = '#page-1';
          }
          var value = hash.match(/#?(page-[0-9])(\/([a-z]+-[a-z-]+)).*/);
          var page = '';
          var subpage = '';
          if (!value) {
            page = 'page-1';
          } else {
            page = value[1];
            subpage = value[3];
          }

          switch (page) {
            default:
            case 'page-1':
              initPage1();
              break;
            case 'page-2':
              initPage2(subpage);
              break;
            case 'page-3':
              initPage3(subpage);
              break;
          }

          $('.page').addClass('hidden');
          $('#' + page).removeClass('hidden');
        }

        function initPage1() {
          var $candidates = $('.candidates').empty();

          $(candidates).each(function(index, candidate) {
            var $candidate = $('#templates').find('.candidate').clone();
            var $a = $candidate.find('a');
            $a.attr('href', ('#page-2/' + candidate.id))
                .css({backgroundImage : 'url(' + candidate.imageUrl + ')'})
                .find('img').attr('src', candidate.imageUrl);
            $a.find('.name').html(candidate.name);
            $a.find('.party').html(candidate.party.shortname);
            $candidates.append($candidate);
          });
        }

        function getCandidateById(id) {
          for (var index = 0; index < candidates.length; index++) {
            if (candidates[index].id === id) {
              return candidates[index];
            }
          }
          return false;
        }

        function initPage2(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-2');
          $page.find('.candidateName').html(currentCandidate.name);

          $('.questions', $page).empty();
          $(questions).each(function(index, question) {
            var $question = $('#templates').find('.question').clone();
            $('.questions', $page).append($question);

            $question.attr('id', 'question-' + index);
            $('.text h3', $question).html((index + 1) + '. ' + question.text);

            var $slider = $('.sliderHandle', $question).slider({
              min: 1,
              ticks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
              /*ticks_labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10']*/
            });
            $slider.find('.slider-handle').trigger('click');
            var key = currentCandidate.id + '.question-' + index;
            var value = sessionStorage.getItem(key);
            if (value !== null) {
              $slider = $slider.slider('setValue', parseInt(value));
            }

            value = $slider.slider('getValue');
            sessionStorage.setItem(key, value);
            $slider.on('change', function(event) {
              var value = event.value.newValue;
              sessionStorage.setItem(key, value);
            });
          });

          $('button.back', $page).on('click', function(event) {
            event.preventDefault();
            $('html,body').scrollTop(0);
            window.location.hash = '#page-1';
          });

          $('button.reset', $page).on('click', function(event) {
            event.preventDefault();
            $('.question', $page).each(function(index, question) {
              $('.sliderHandle', question).slider('setValue', 5);
              var key = currentCandidate.id + '.question-' + index;
              sessionStorage.setItem(key, 5);
            });
            $('html,body').scrollTop(0);
          });

          $('button.next', $page).on('click', function(event) {
            event.preventDefault();
            $('html,body').scrollTop(0);
            window.location.hash = '#page-3/' + currentCandidate.id;
          });
        }

        function initPage3(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-3');
          $page.find('.candidateName').html(currentCandidate.name);

          var score = 100;

          $('.results', $page).empty();
          $(questions).each(function(index, question) {
            var key = currentCandidate.id + '.question-' + index;
            var userValue = sessionStorage.getItem(key);
            var candidateValue = question.answers[currentCandidate.id].answer;
            var difference = Math.abs(userValue - candidateValue);
            score -= difference;

            var $result = $('#templates').find('.result').clone();
            $result.attr('id', 'question-' + index);
            $('.text h3', $result).html((index + 1) + '. ' + question.text);


            $result.find('.candidateName').html(currentCandidate.name);
            $result.find('.userValue img').attr('alt', userValue).attr('src', 'images/numbers/grey/g' + userValue + '.png');
            $result.find('.candidateValue img').attr('alt', candidateValue).attr('src', 'images/numbers/black/' + candidateValue + '.png');
            $result.find('.resultMeaning img').attr('alt', difference).attr('src', 'images/numbers/white/w' + difference + '.png');

            var videoId = question.answers[currentCandidate.id].youtubeVideoId;
            var videoUrl = '//www.youtube-nocookie.com/embed/' + videoId + '?autoplay=1&amp;rel=0&amp;showinfo=0';
            var thumbnailUrl = '//img.youtube.com/vi/' + videoId + '/hqdefault.jpg';

            var $img = $result.find('.video > div');
            var $iframe = $result.find('.video iframe');
            $img.css('background-image', 'url(' + thumbnailUrl + ')');

            $img.on('click', function() {
              $iframe.removeClass('hidden');
              $iframe.attr('src', videoUrl);
            });

            $page.find('.results').append($result);
          });

          var congratulationLine = '';
          var maxScore = 0;
          $(congratulationLines).each(function(index, line) {
            if (line.minScore <= score && maxScore <= line.minScore) {
              congratulationLine = line.text;
            }
          });

          $page.find('.congratulations').html(congratulationLine);

          $page.find('.score').html(score);

          var shareText = 'Ich habe als ' + currentCandidate.name + ' eine Score von ' + score + ' erreicht!';
          var facebookShareLink = '//www.facebook.com/sharer/sharer.php?u=' + window.location.href;
          var twitterShareLink = '//twitter.com/home?status=' + shareText + '%20' + window.location.href;
          $page.find('.facebook').attr('href', facebookShareLink);
          $page.find('.twitter').attr('href', twitterShareLink);


          $('button.back', $page).on('click', function(event) {
            event.preventDefault();
            $page.find('.video iframe').attr('src', '');
            $('html,body').scrollTop(0);
            window.location.hash = '#page-2/' + currentCandidate.id;
          });

          $('button.start', $page).on('click', function(event) {
            event.preventDefault();
            $page.find('.video iframe').attr('src', '');
            $('html,body').scrollTop(0);
            window.location.hash = '#';
          });
        }
      });
    </script>
  </body>
</html>
