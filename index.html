<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>neuwal barometer</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div class="container" id="content">
      <h1><a href="#">neuwal barometer</a></h1>

      <section id="page-1" class="page row">
        <div class="col-md-12">
          <h2>Einleitung</h2>

          <p>
            Lorem ipsum dolor sit amet, cu quando impedit cotidieque duo, vitae nostrum assentior
            ne nam, sea an dico sint ullum. Ad has justo errem, labore everti posidonium et duo.
            Harum dolor fastidii ne quo. Eam ea mazim adipisci, audiam hendrerit eum ea. Wisi
            mucius mel te. Mea virtute omnesque periculis ea.
          </p>

          <h3>Wähle einen Kandidaten..</h3>
        </div>

        <div class="candidates">

        </div>
      </section>

      <section id="page-2" class="page hidden">
        <h2>Wie würdest du als <span class="candidateName">???</span> abstimmen?</h2>

        <div class="questions">

        </div>

        <button class="btn btn-primary reset">Zurücksetzen</button>
        <button class="btn btn-primary next">Zur Auswertung</button>
      </section>

      <section id="page-3" class="page hidden">
        <h2>Ergebnisse: <span class="candidateName">???</span></h2>

        <div class="results">

        </div>

        <div class="finalResult">
          <span class="congratulations"></span><br />
          Score: <span class="score"></span>
        </div>

        <p>
          Auf <a class="facebook" href="" target="_blank">Facebook</a> oder <a class="twitter" href="" target="_blank">Twitter</a> teilen!
        </p>


        <button class="btn btn-primary">Zurück zum Start</button>
      </section>
    </div>

    <div id="templates" class="hidden">
      <div class="col-lg-3 col-md-4 col-sm-6 col-xs-6 candidate">
        <a href="#">
          <p>
            <span class="party"></span> - <span class="name"></span>
          </p>
        </a>
      </div>
      <div class="row question">
        <div class="col-md-6 text"></div>
        <div class="col-md-6 answer"><input class="sliderHandle" /></div>
      </div>
      <div class="row result">
        <div class="col-md-12 text"></div>
        <div class="col-md-6 video">
          <iframe width="560" height="315" src="" frameborder="0" allowfullscreen></iframe>
        </div>
        <div class="col-md-6 answer">
          <p>
            Du hast du <span class="userValue">x</span> getippt, <span class="candidateName"></span> hat <span class="candidateValue">x</span> geantwortet.
          </p>
          <p class="resultMeaning">

          </p>
        </div>
      </div>
    </div>

    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script>
      'use strict';

      var candidates = [
        {
          "id": "spoe-haeupl",
          "name": "Michael Häupl",
          "party": {
            "shortname": "SPÖ",
            "name": "Sozialdemokratische Partei Österreichs"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "fpoe-strache",
          "name": "Heinz-Christian Strache",
          "party": {
            "shortname": "FPÖ",
            "name": "Freiheitliche Partei Österreichs"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "oevp-juraczka",
          "name": "Manfred Juraczka",
          "party": {
            "shortname": "ÖVP",
            "name": "Österreichische Volkspartei"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "gruene-vassilakou",
          "name": "Maria Vassilakou",
          "party": {
            "shortname": "GRÜNE",
            "name": "Die Grünen – Die Grüne Alternative"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "neos-meinl-reisinger",
          "name": "Beate Meinl-Reisinger",
          "party": {
            "shortname": "NEOS",
            "name": "NEOS – Das Neue Österreich und Liberales Forum"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "andas-okropiridse",
          "name": "Juliana Okropiridse",
          "party": {
            "shortname": "ANDAS",
            "name": "Wien anders"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "www-pollischansky",
          "name": "Heinz Pollischansky",
          "party": {
            "shortname": "WWW",
            "name": "WWW - Wir Wollen Wahlfreiheit"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "gfw-taskiran",
          "name": "Turgay Taskiran",
          "party": {
            "shortname": "GFW",
            "name": "GfW - Gemeinsam für Wien"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        }
      ];

      var questions = [
        {
          "text": "AsylwerberInnen sollen arbeiten dürfen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "5",
              "youtubeVideoId": "W0vZuE3Riqg"
            },
            "fpoe-strache": {
              "answer": "3",
              "youtubeVideoId": "kcJbjTt9kI0"
            },
            "gruene-vassilakou": {
              "answer": "10",
              "youtubeVideoId": "DzQyQijfRt4"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "TxmtnKAEQNU"
            },
            "neos-meinl-reisinger": {
              "answer": "8",
              "youtubeVideoId": "XURg2PReiRI"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "3BSDIlkui30"
            },
            "www-pollischansky": {
              "answer": "10",
              "youtubeVideoId": "DWa8AFUEIoQ"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "NpYDM3x5tpo"
            }
          }
        },
        {
          "text": "Bezirksquoten sollen eingeführt werden, um die Verteilung der Flüchtlinge zu regeln.",
          "answers": {
            "spoe-haeupl": {
              "answer": "8",
              "youtubeVideoId": "JxXBDnobVqI"
            },
            "fpoe-strache": {
              "answer": "1",
              "youtubeVideoId": "svvWCfJ33nM"
            },
            "gruene-vassilakou": {
              "answer": "9",
              "youtubeVideoId": "Quv89FHMJRI"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "fvlAlNR_A-M"
            },
            "neos-meinl-reisinger": {
              "answer": "7",
              "youtubeVideoId": "QPk5T7ZGFAo"
            },
            "andas-okropiridse": {
              "answer": "5",
              "youtubeVideoId": "kwNyXVcq5Gg"
            },
            "www-pollischansky": {
              "answer": "6",
              "youtubeVideoId": "lGE85YVZTGQ"
            },
            "gfw-taskiran": {
              "answer": "8",
              "youtubeVideoId": "5YyZOTj-vew"
            }
          }
        },
        {
          "text": "Die Unterstützung für Arbeitslose sollte gesenkt werden, um mehr Anreize bei der Arbeitssuche zu schaffen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "nHXfev2e3_s"
            },
            "fpoe-strache": {
              "answer": "8",
              "youtubeVideoId": "kJxLoB2E_cg"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "Uzx9ONOHSUg"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "hZiACfntWEY"
            },
            "neos-meinl-reisinger": {
              "answer": "2",
              "youtubeVideoId": "3Qx6t_V_Iho"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "RvNUpbmoleo"
            },
            "www-pollischansky": {
              "answer": "4",
              "youtubeVideoId": "_8bTa8S4TRs"
            },
            "gfw-taskiran": {
              "answer": "7",
              "youtubeVideoId": "mdF3fOuuKpA"
            }
          }
        },
        {
          "text": "Nur durch Privatisierungen schaffe ich konkurrenzfähige Unternehmen und somit auch Arbeitsplätze.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "idwo9ywA-XA"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "RtIHlTuEMjQ"
            },
            "gruene-vassilakou": {
              "answer": "2",
              "youtubeVideoId": "T4Rs2htRxEY"
            },
            "oevp-juraczka": {
              "answer": "5",
              "youtubeVideoId": "nH5N_9XqnPI"
            },
            "neos-meinl-reisinger": {
              "answer": "5",
              "youtubeVideoId": "_QWJ3ZPdrEo"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "Ld3N8WuXQCQ"
            },
            "www-pollischansky": {
              "answer": "2",
              "youtubeVideoId": "uSIRrymo-6g"
            },
            "gfw-taskiran": {
              "answer": "5",
              "youtubeVideoId": "WE7TyPxeHzI"
            }
          }
        },
        {
          "text": "Es braucht eigene Klassen für SchülerInnen, die nicht über ausreichende Deutschkenntnisse verfügen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "2",
              "youtubeVideoId": "be2kXEewO6s"
            },
            "fpoe-strache": {
              "answer": "9",
              "youtubeVideoId": "nl_2Z4Els_g"
            },
            "gruene-vassilakou": {
              "answer": "2",
              "youtubeVideoId": "QdwSbKOr2eE"
            },
            "oevp-juraczka": {
              "answer": "10",
              "youtubeVideoId": "qmJyrG4azj8"
            },
            "neos-meinl-reisinger": {
              "answer": "7",
              "youtubeVideoId": "AtDw-ASl2gg"
            },
            "andas-okropiridse": {
              "answer": "2",
              "youtubeVideoId": "ulLCw9f9_1s"
            },
            "www-pollischansky": {
              "answer": "10",
              "youtubeVideoId": "TmM3knk-pCI"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "Txd5R95sMGA"
            }
          }
        },
        {
          "text": "Politische Bildung ist zu teuer.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "8BdJAocitNg"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "a-GG1qMed1E"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "j4r7vul92T0"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "MU3N5RblSZQ"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "aFA6rfbb4zk"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "RztPQ8lo6dQ"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "iJMzAme8u4Y"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "It0_YcabCYw"
            }
          }
        },
        {
          "text": "Im Zweifel müssen umweltpolitische Bedenken wirtschaftlichen Interessen weichen.",
          "answers": {
            "spoe-haeupl": {
              "answer": "7",
              "youtubeVideoId": "gcHWiJgyw94"
            },
            "fpoe-strache": {
              "answer": "5",
              "youtubeVideoId": "Ah7Lou8slOs"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "MDbvAazl10w"
            },
            "oevp-juraczka": {
              "answer": "6",
              "youtubeVideoId": "MVa-1f4myLg"
            },
            "neos-meinl-reisinger": {
              "answer": "3",
              "youtubeVideoId": "bVePHg-RR7Y"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "d9dMWLTEzno"
            },
            "www-pollischansky": {
              "answer": "5",
              "youtubeVideoId": "RSh2qVK5W34"
            },
            "gfw-taskiran": {
              "answer": "1",
              "youtubeVideoId": "YXLKt6J3GTY"
            }
          }
        },
        {
          "text": "Meine verkehrspolitische Vision basiert auf einer autofreien Stadt.",
          "answers": {
            "spoe-haeupl": {
              "answer": "4",
              "youtubeVideoId": "N3KuKVRnDV8"
            },
            "fpoe-strache": {
              "answer": "1",
              "youtubeVideoId": "Q7GsQkIRo5s"
            },
            "gruene-vassilakou": {
              "answer": "7",
              "youtubeVideoId": "zpc5-Eswq6U"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "h4E72QiAmjY"
            },
            "neos-meinl-reisinger": {
              "answer": "6",
              "youtubeVideoId": "aMVJO5QgjU0"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "BC16d7-LqWI"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "wUvOUb43ArY"
            },
            "gfw-taskiran": {
              "answer": "5",
              "youtubeVideoId": "DXellZO3dco"
            }
          }
        },
        {
          "text": "Für private Altbauwohnungen soll es Mietobergrenzen geben.",
          "answers": {
            "spoe-haeupl": {
              "answer": "9",
              "youtubeVideoId": "Kc1kVuCsQlg"
            },
            "fpoe-strache": {
              "answer": "4",
              "youtubeVideoId": "CeQ6QLAMlFk"
            },
            "gruene-vassilakou": {
              "answer": "9",
              "youtubeVideoId": "__1rwAX6ECc"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "CSgYHxMwEcA"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "gD-eTRY3iLM"
            },
            "andas-okropiridse": {
              "answer": "6",
              "youtubeVideoId": "oZJl7Bk40nk"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "0IVQH2PqMF0"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "kL4pNkpGSoc"
            }
          }
        },
        {
          "text": "Die regelmäßige Überprüfung der Einkommen von BewohnerInnen von Gemeinde- oder Genossenschaftswohnungen wäre gerechtfertigt.",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "Y8dLTtFWDPc"
            },
            "fpoe-strache": {
              "answer": "5",
              "youtubeVideoId": "CeQ6QLAMlFk"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "pitPhZ2xfnU"
            },
            "oevp-juraczka": {
              "answer": "10",
              "youtubeVideoId": "Gr1srS6-7O8"
            },
            "neos-meinl-reisinger": {
              "answer": "10",
              "youtubeVideoId": "86nmORL76fw"
            },
            "andas-okropiridse": {
              "answer": "10",
              "youtubeVideoId": "V_gB-TzWHYw"
            },
            "www-pollischansky": {
              "answer": "1",
              "youtubeVideoId": "U_fpYDYG3TM"
            },
            "gfw-taskiran": {
              "answer": "10",
              "youtubeVideoId": "05BwMh6I4-s"
            }
          }
        }
      ];

      var congratulationLines = [
        {
          "text": "Du bist super gut.",
          "minScore": 90
        },
        {
          "text": "Fail.",
          "minScore": 0
        }
      ];

      var currentCandidate = null;

      $(function() {
        init();

        function init() {
          currentCandidate = null;

          // set url to current page
          showPage(window.location.hash);

          $(window).on('hashchange', function(event) {
            event.preventDefault();
            showPage(window.location.hash);
          });
        }

        function showPage(hash) {
          if (!hash) {
            hash = '#page-1';
          }
          var value = hash.match(/#?(page-[0-9])(\/([a-z]+-[a-z-]+)).*/);
          var page = '';
          var subpage = '';
          if (!value) {
            page = 'page-1';
          } else {
            page = value[1];
            subpage = value[3];
          }

          switch (page) {
            default:
            case 'page-1':
              initPage1();
              break;
            case 'page-2':
              initPage2(subpage);
              break;
            case 'page-3':
              initPage3(subpage);
              break;
          }

          $('.page').addClass('hidden');
          $('#' + page).removeClass('hidden');
        }

        function initPage1() {
          var $candidates = $('.candidates').empty();

          $(candidates).each(function(index, candidate) {
            var $candidate = $('#templates').find('.candidate').clone();
            var $a = $candidate.find('a');
            $a.attr('href', ('#page-2/' + candidate.id))
                .css({backgroundImage : 'url(' + candidate.imageUrl + ')'})
                .find('img').attr('src', candidate.imageUrl);
            $a.find('.name').html(candidate.name);
            $a.find('.party').html(candidate.party.shortname);
            $candidates.append($candidate);
          });
        }

        function getCandidateById(id) {
          for (var index = 0; index < candidates.length; index++) {
            if (candidates[index].id === id) {
              return candidates[index];
            }
          }
          return false;
        }

        function initPage2(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-2');
          $page.find('.candidateName').html(currentCandidate.name);

          $('.questions', $page).empty();
          $(questions).each(function(index, question) {
            var $question = $('#templates').find('.question').clone();
            $question.attr('id', 'question-' + index);
            $('.text', $question).html(question.text);

            var $slider = $('.sliderHandle', $question).slider({
              min: 1
            });
            var key = currentCandidate.id + '.question-' + index;
            var value = sessionStorage.getItem(key);
            if (value !== null) {
              $slider = $slider.slider('setValue', parseInt(value));
            }

            value = $slider.slider('getValue');
            sessionStorage.setItem(key, value);
            $slider.on('change', function(event) {
              var value = event.value.newValue;
              sessionStorage.setItem(key, value);
            });
            $('.questions', $page).append($question);
          });

          $('button.reset', $page).on('click', function(event) {
            event.preventDefault();
            $('.question', $page).each(function(index, question) {
              $('.sliderHandle', question).slider('setValue', 5);
              var key = currentCandidate.id + '.question-' + index;
              sessionStorage.setItem(key, 5);
            });
          });

          $('button.next', $page).on('click', function(event) {
            event.preventDefault();
            window.location.hash = '#page-3/' + currentCandidate.id;
          });
        }

        function initPage3(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-3');
          $page.find('.candidateName').html(currentCandidate.name);

          var score = 100;

          $('.results', $page).empty();
          $(questions).each(function(index, question) {
            var key = currentCandidate.id + '.question-' + index;
            var userValue = sessionStorage.getItem(key);
            var candidateValue = question.answers[currentCandidate.id].answer;
            var difference = Math.abs(userValue - candidateValue);
            score -= difference;

            var $result = $('#templates').find('.result').clone();
            $result.attr('id', 'question-' + index);
            $('.text', $result).html(question.text);


            $result.find('.candidateName').html(currentCandidate.name);
            $result.find('.userValue').html(userValue);
            $result.find('.candidateValue').html(candidateValue);
            if (difference > 0) {
              $result.find('.resultMeaning').html('- ' + difference);
            } else {
              $result.find('.resultMeaning').html('Perfekt!');
            }
            var videoUrl = 'https://www.youtube-nocookie.com/embed/';
            videoUrl += question.answers[currentCandidate.id].youtubeVideoId + '?rel=0&amp;showinfo=0';

            $result.find('.video iframe').attr('src', videoUrl);

            $page.find('.results').append($result);
          });

          var congratulationLine = '';
          var maxScore = 0;
          $(congratulationLines).each(function(index, line) {
            if (line.minScore <= score && maxScore <= line.minScore) {
              congratulationLine = line.text;
            }
          });

          $page.find('.congratulations').html(congratulationLine);

          $page.find('.score').html(score);

          var shareText = 'Ich habe als ' + currentCandidate.name + ' eine Score von ' + score + ' erreicht!';
          var facebookShareLink = '//www.facebook.com/sharer/sharer.php?u=' + window.location.href;
          var twitterShareLink = '//twitter.com/home?status=' + shareText + '%20' + window.location.href;
          $page.find('.facebook').attr('href', facebookShareLink);
          $page.find('.twitter').attr('href', twitterShareLink);

          $('button', $page).on('click', function(event) {
            event.preventDefault();
            window.location.hash = '#';
          });
        }
      });
    </script>
  </body>
</html>
