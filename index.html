<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>neuwal barometer</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div class="container" id="content">
      <h1><a href="#">neuwal barometer</a></h1>

      <section id="page-1" class="page row">
        <div class="col-md-12">
          <h2>Einleitung</h2>

          <p>
            Lorem ipsum dolor sit amet, cu quando impedit cotidieque duo, vitae nostrum assentior
            ne nam, sea an dico sint ullum. Ad has justo errem, labore everti posidonium et duo.
            Harum dolor fastidii ne quo. Eam ea mazim adipisci, audiam hendrerit eum ea. Wisi
            mucius mel te. Mea virtute omnesque periculis ea.
          </p>

          <h3>Wähle einen Kandidaten..</h3>
        </div>

        <div class="candidates">

        </div>
      </section>

      <section id="page-2" class="page hidden">
        <h2>Wie würdest du als <span class="candidateName">???</span> abstimmen?</h2>

        <div class="questions">

        </div>

        <button class="reset">Zurücksetzen</button>
        <button class="next">Zur Auswertung</button>
      </section>

      <section id="page-3" class="page hidden">
        <h2>Ergebnisse: <span class="candidateName">???</span></h2>

        <div class="results">

        </div>

        <button>Zurück zum Start</button>
      </section>
    </div>

    <div id="templates" class="hidden">
      <div class="col-md-4 candidate">
        <a href="#">
          <img class="img-responsive" src="" alt="" />
        </a>
      </div>
      <div class="row question">
        <div class="col-md-6 text"></div>
        <div class="col-md-6 answer"><div class="sliderHandle"></div></div>
      </div>
      <div class="row result">
        <div class="col-md-6 text"></div>
        <div class="col-md-6 answer"><</div>
      </div>
    </div>

    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script>
      'use strict';

      var candidates = [
        {
          "id": "spoe-haeupl",
          "name": "Michael Häupl",
          "party": {
            "shortname": "SPÖ",
            "name": "Sozialdemokratische Partei Österreichs"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "fpoe-strache",
          "name": "Heinz-Christian Strache",
          "party": {
            "shortname": "FPÖ",
            "name": "Freiheitliche Partei Österreichs"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "oevp-juraczka",
          "name": "Manfred Juraczka",
          "party": {
            "shortname": "ÖVP",
            "name": "Österreichische Volkspartei"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "gruene-vassilakou",
          "name": "Maria Vassilakou",
          "party": {
            "shortname": "GRÜNE",
            "name": "Die Grünen – Die Grüne Alternative"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "neos-meinl-reisinger",
          "name": "Beate Meinl-Reisinger",
          "party": {
            "shortname": "NEOS",
            "name": "NEOS – Das Neue Österreich und Liberales Forum"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        },
        {
          "id": "andas-okropiridse",
          "name": "Juliana Okropiridse",
          "party": {
            "shortname": "ANDAS",
            "name": "Wien anders"
          },
          "imageUrl": "images/candiates/spoe-haeupl.jpg"
        }
      ];

      var questions = [
        {
          "text": "test1",
          "answers": {
            "spoe-haeupl": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "fpoe-strache": {
              "answer": "3",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            }
          }
        },
        {
          "text": "test2",
          "answers": {
            "spoe-haeupl": {
              "answer": "3",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "fpoe-strache": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "oevp-juraczka": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "gruene-vassilakou": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "neos-meinl-reisinger": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            },
            "andas-okropiridse": {
              "answer": "1",
              "youtubeVideoId": "6MDf83CAbxw"
            }
          }
        },
      ];

      var currentCandidate = null;

      $(function() {
        init();

        function init() {
          currentCandidate = null;

          // set url to current page
          showPage(window.location.hash);

          $(window).on('hashchange', function(event) {
            event.preventDefault();
            showPage(window.location.hash);
          });
        }

        function showPage(hash) {
          if (!hash) {
            hash = '#page-1';
          }
          var value = hash.match(/#?(page-[0-9])(\/([a-z]+-[a-z]+)).*/);
          var page = '';
          var subpage = '';
          if (!value) {
            page = 'page-1';
          } else {
            page = value[1];
            subpage = value[3];
          }

          switch (page) {
            default:
            case 'page-1':
              initPage1();
              break;
            case 'page-2':
              initPage2(subpage);
              break;
            case 'page-3':
              initPage3(subpage);
              break;
          }

          $('.page').addClass('hidden');
          $('#' + page).removeClass('hidden');
        }

        function initPage1() {
          var $candidates = $('.candidates').empty();

          $(candidates).each(function(index, candidate) {
            var $candidate = $('#templates').find('.candidate').clone();
            $candidate.find('a').attr('href', ('#page-2/' + candidate.id))
                .find('img').attr('src', candidate.imageUrl);
            $candidates.append($candidate);
          });
        }

        function getCandidateById(id) {
          for (var index = 0; index < candidates.length; index++) {
            if (candidates[index].id === id) {
              return candidates[index];
            }
          }
          return false;
        }

        function initPage2(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-2');
          $page.find('.candidateName').html(currentCandidate.name);

          $('.questions', $page).empty();
          $(questions).each(function(index, question) {
            var $question = $('#templates').find('.question').clone();
            $question.attr('id', 'question-' + index);
            $('.text', $question).html(question.text);

            var $slider = $('.sliderHandle', $question).slider();
            var key = currentCandidate.id + '.question-' + index;
            var value = sessionStorage.getItem(key);
            if (value !== null) {
              $slider = $slider.slider('setValue', parseInt(value));
            }

            value = $slider.slider('getValue');
            sessionStorage.setItem(key, value);
            $slider.on('change', function(event) {
              var value = event.value.newValue;
              sessionStorage.setItem(key, value);
            });
            $('.questions', $page).append($question);
          });

          $('button.reset', $page).on('click', function(event) {
            event.preventDefault();
            $('.question', $page).each(function(index, question) {
              $('.sliderHandle', question).slider('setValue', 5);
              var key = currentCandidate.id + '.question-' + index;
              sessionStorage.setItem(key, 5);
            });
          });

          $('button.next', $page).on('click', function(event) {
            event.preventDefault();
            window.location.hash = '#page-3/' + currentCandidate.id;
          });
        }

        function initPage3(subpage) {
          currentCandidate = getCandidateById(subpage);
          if (!currentCandidate) {
            showPage();
            return;
          }
          var $page = $('#page-3');
          $page.find('.candidateName').html(currentCandidate.name);

          $('.results', $page).empty();
          $(questions).each(function(index, question) {
            var $result = $('#templates').find('.result').clone();
            $result.attr('id', 'question-' + index);
            $('.text', $result).html(question.text);

            var key = currentCandidate.id + '.question-' + index;
            var userValue = sessionStorage.getItem(key);
            var candidateValue = question.answers[currentCandidate.id].answer;
            $('.answer', $result).html('user: ' + userValue + ', candidate: ' + candidateValue);

            $('.results', $page).append($result);

            $('button', $page).on('click', function(event) {
              event.preventDefault();
              window.location.hash = '#';
            });
          });
        }
      });
    </script>
  </body>
</html>
